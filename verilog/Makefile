# ==========================================
#  Verilog é€šç”¨è‡ªå‹•åŒ–è…³æœ¬ (Makefile)
#  é©ç”¨ï¼šIcarus Verilog + GTKWave / WaveTrace
# ==========================================

# 1. è®Šæ•¸è¨­å®š
# æ‰¾å‡ºç•¶å‰è³‡æ–™å¤¾ä¸‹æ‰€æœ‰çš„ .v æª”æ¡ˆ
SRCS = $(wildcard *.v)
# è¨­å®šè¼¸å‡ºåŸ·è¡Œæª”çš„åç¨±
PROJ = simulation
# è¨­å®šæ³¢å½¢æª”åç¨± (å¿…é ˆè·Ÿä½ çš„ testbench $dumpfile è£¡é¢çš„åå­—ä¸€æ¨£)
WAVE = waveform.vcd

# 2. ä¸»è¦æŒ‡ä»¤ (è¼¸å…¥ make æœƒåŸ·è¡Œçš„å‹•ä½œ)
# é‚è¼¯ï¼šå…ˆç·¨è­¯(compile) -> å†åŸ·è¡Œ(run)
all: clean compile run

# ç·¨è­¯ï¼šæŠŠæ‰€æœ‰ .v æª”è®Šæˆä¸€å€‹åŸ·è¡Œæª”
compile:
	@echo "ğŸ”¨ Compiling..."
	iverilog -o $(PROJ) $(SRCS)

# åŸ·è¡Œï¼šè·‘æ¨¡æ“¬ï¼Œä¸¦ç”¢ç”Ÿæ³¢å½¢
run:
	@echo "ğŸš€ Running Simulation..."
	vvp $(PROJ)
	@echo "âœ… Done! Waveform generated: $(WAVE)"

# 3. æ¸…é™¤æŒ‡ä»¤ (è¼¸å…¥ make clean æœƒåŸ·è¡Œçš„å‹•ä½œ)
clean:
	@echo "ğŸ§¹ Cleaning up..."
	rm -f $(PROJ) $(WAVE)

# å½ç›®æ¨™è¨­å®š (é¿å…è³‡æ–™å¤¾å‰›å¥½æœ‰è·ŸæŒ‡ä»¤åŒåçš„æª”æ¡ˆ)
.PHONY: all compile run clean